<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QA Test Stand — Smoke / Release Approval</title>
  <meta name="color-scheme" content="light" />
  <style>
    :root{
      --bg: #f6f7fb;
      --panel: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --muted2:#64748b;
      --border:#e5e7eb;
      --shadow: 0 10px 30px rgba(15,23,42,.08);
      --shadow2: 0 6px 18px rgba(15,23,42,.08);
      --radius: 16px;
      --radius2: 12px;
      --ring: 0 0 0 4px rgba(59,130,246,.18);
      --blue:#2563eb;
      --blue2:#1d4ed8;
      --green:#16a34a;
      --red:#dc2626;
      --amber:#d97706;
      --chip:#eef2ff;
      --dangerbg:#fff1f2;
      --dangerbd:#fecdd3;
      --danger:#be123c;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 20% -10%, rgba(37,99,235,.10), transparent 60%),
        radial-gradient(900px 500px at 90% 5%, rgba(16,185,129,.10), transparent 55%),
        var(--bg);
    }

    a, button{ font-family: inherit; }
    .wrap{
      max-width: 1040px;
      margin: 0 auto;
      padding: 28px 18px 56px;
    }

    header{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      margin-bottom: 18px;
    }
    .brand{
      display:flex;
      align-items:flex-start;
      gap:12px;
    }
    .logo{
      width: 44px;
      height: 44px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(37,99,235,.15), rgba(16,185,129,.12));
      border:1px solid rgba(226,232,240,.9);
      box-shadow: var(--shadow2);
      display:grid;
      place-items:center;
      flex:0 0 auto;
    }
    .brand h1{
      font-size: 16px;
      margin: 2px 0 2px;
      letter-spacing: .2px;
    }
    .brand p{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.35;
    }
    .meta{
      display:flex;
      flex-direction:column;
      align-items:flex-end;
      gap:8px;
      text-align:right;
    }
    .pillrow{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .pill{
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.75);
      box-shadow: 0 1px 0 rgba(15,23,42,.03);
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
    }
    .pill strong{ color: var(--text); font-weight:600; }

    main{
      display:grid;
      gap: 14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
    }

    .card{
      background: var(--panel);
      border: 1px solid rgba(226,232,240,.9);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding: 16px 18px 12px;
      border-bottom: 1px solid rgba(226,232,240,.75);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
    }
    .card .hd h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .card .hd .sub{
      margin-top: 2px;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.35;
    }
    .card .bd{
      padding: 16px 18px 18px;
    }

    .kv{
      display:grid;
      grid-template-columns: 180px 1fr;
      gap: 10px 14px;
      align-items:center;
    }
    .k{ color: var(--muted2); font-size: 12.5px; }
    .v{ font-size: 13.5px; }
    .v code{
      font-family: var(--mono);
      font-size: 12.5px;
      background: #f1f5f9;
      border: 1px solid rgba(226,232,240,.9);
      padding: 2px 8px;
      border-radius: 999px;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:1px solid transparent;
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 13.5px;
      line-height: 1;
      cursor:pointer;
      background: var(--blue);
      color: white;
      box-shadow: 0 8px 18px rgba(37,99,235,.18);
      transition: transform .14s ease, box-shadow .14s ease, background .14s ease, border-color .14s ease, opacity .14s ease;
    }
    .btn:hover{ background: var(--blue2); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0); box-shadow: 0 6px 14px rgba(37,99,235,.16); }
    .btn:disabled{
      opacity:.55;
      cursor:not-allowed;
      transform:none;
      box-shadow:none;
    }

    .btn.secondary{
      background: #fff;
      color: var(--text);
      border-color: rgba(226,232,240,.95);
      box-shadow: 0 8px 18px rgba(15,23,42,.08);
    }
    .btn.secondary:hover{ background:#f8fafc; }

    .btn.danger{
      background: transparent;
      color: var(--danger);
      border-color: var(--dangerbd);
      box-shadow: none;
    }
    .btn.danger:hover{
      background: var(--dangerbg);
      border-color: #fda4af;
      transform: translateY(-1px);
    }

    .hint{
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.35;
    }
    .hint code{
      font-family: var(--mono);
      background:#f1f5f9;
      border:1px solid rgba(226,232,240,.9);
      padding: 1px 6px;
      border-radius: 8px;
      font-size: 12px;
    }

    .progress{
      display:none;
      gap:12px;
      align-items:center;
      margin-top: 8px;
    }
    .progress.show{ display:flex; }
    .spinner{
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid rgba(148,163,184,.4);
      border-top-color: rgba(37,99,235,.9);
      animation: spin .9s linear infinite;
      flex:0 0 auto;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }
    .bar{
      height: 10px;
      width: 100%;
      background: #eef2ff;
      border-radius: 999px;
      border:1px solid rgba(226,232,240,.9);
      overflow:hidden;
      position:relative;
    }
    .bar > i{
      display:block;
      height:100%;
      width: 38%;
      background: linear-gradient(90deg, rgba(37,99,235,.88), rgba(16,185,129,.75));
      border-radius:999px;
      animation: sweep 1.15s ease-in-out infinite;
    }
    @keyframes sweep{
      0%{ transform: translateX(-40%); }
      50%{ transform: translateX(120%); }
      100%{ transform: translateX(-40%); }
    }
    .progtext{ font-size: 12.5px; color: var(--muted); white-space:nowrap; }

    .tests{
      margin-top: 12px;
      display:none;
    }
    .tests.show{ display:block; }
    .trow{
      display:grid;
      grid-template-columns: 1fr auto auto;
      gap: 10px;
      align-items:center;
      padding: 10px 12px;
      border: 1px solid rgba(226,232,240,.9);
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 1px 0 rgba(15,23,42,.03);
      margin-bottom: 10px;
    }
    .tname{
      font-size: 13px;
      color: var(--text);
    }
    .tmeta{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted2);
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(226,232,240,.9);
      background: #f8fafc;
      white-space:nowrap;
    }
    .badge{
      font-family: var(--mono);
      font-size: 12px;
      padding: 5px 10px;
      border-radius: 999px;
      border:1px solid;
      white-space:nowrap;
      letter-spacing:.25px;
    }
    .badge.pass{
      color: #166534;
      background: rgba(22,163,74,.10);
      border-color: rgba(22,163,74,.25);
    }
    .badge.fail{
      color: #991b1b;
      background: rgba(220,38,38,.10);
      border-color: rgba(220,38,38,.25);
    }
    .badge.slot{
      color: #1e3a8a;
      background: rgba(37,99,235,.10);
      border-color: rgba(37,99,235,.25);
    }
    .badge.neutral{
      color:#0f172a;
      background:#f1f5f9;
      border-color:rgba(148,163,184,.45);
    }

    .linkbtn{
      appearance:none;
      border:none;
      background: transparent;
      color: var(--blue2);
      font-size: 12.5px;
      cursor:pointer;
      padding: 6px 8px;
      border-radius: 10px;
      transition: background .14s ease, color .14s ease;
      text-align:right;
      justify-self:end;
      white-space:nowrap;
    }
    .linkbtn:hover{ background: rgba(37,99,235,.08); }
    .linkbtn:disabled{ opacity:.5; cursor:not-allowed; }

    .approveRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px dashed rgba(148,163,184,.35);
    }

    .reveal{
      display:none;
    }
    .reveal.show{ display:block; }
    .fadeIn{
      animation: fadeIn .22s ease-out both;
    }
    @keyframes fadeIn{
      from{ opacity:0; transform: translateY(6px); }
      to{ opacity:1; transform: translateY(0); }
    }

    .notes{
      display:grid;
      gap: 10px;
      margin-top: 10px;
    }
    .note{
      padding: 12px 12px;
      border: 1px solid rgba(226,232,240,.9);
      border-radius: 14px;
      background: linear-gradient(180deg, #ffffff, #fbfdff);
    }
    .note h3{
      margin:0 0 6px;
      font-size: 13px;
      letter-spacing:.2px;
    }
    .note p{
      margin:0;
      color: var(--muted);
      font-size: 13px;
      line-height:1.5;
    }

    .slots{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 10px;
      margin-top: 10px;
    }
    @media (max-width: 820px){
      header{ flex-direction:column; align-items:flex-start; }
      .meta{ align-items:flex-start; text-align:left; }
      .grid{ grid-template-columns: 1fr; }
      .kv{ grid-template-columns: 1fr; }
      .slots{ grid-template-columns: 1fr; }
    }

    .slotCard{
      position:relative;
      border-radius: 16px;
      border:1px solid rgba(226,232,240,.95);
      background:#fff;
      box-shadow: 0 1px 0 rgba(15,23,42,.03);
      overflow:hidden;
      transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease;
    }
    .slotCard:hover{
      transform: translateY(-1px);
      box-shadow: 0 10px 24px rgba(15,23,42,.08);
      border-color: rgba(148,163,184,.35);
    }
    .slotCard input{
      position:absolute;
      inset:0;
      opacity:0;
      cursor:pointer;
    }
    .slotCard .inner{
      padding: 12px 12px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .slotCard .title{
      font-size: 13.5px;
      margin: 1px 0 2px;
      letter-spacing:.2px;
    }
    .slotCard .desc{
      font-size: 12.5px;
      color: var(--muted);
      margin:0;
      line-height:1.4;
    }
    .slotCard.selected{
      border-color: rgba(37,99,235,.55);
      box-shadow: 0 12px 30px rgba(37,99,235,.14);
    }

    .fieldRow{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
      margin-top: 12px;
    }
    .field{
      display:grid;
      gap: 6px;
    }
    label{
      font-size: 12.5px;
      color: var(--muted2);
    }
    textarea{
      width:100%;
      min-height: 86px;
      resize: vertical;
      border-radius: 14px;
      border:1px solid rgba(226,232,240,.95);
      padding: 10px 12px;
      font-size: 13.5px;
      line-height:1.45;
      outline:none;
      transition: box-shadow .14s ease, border-color .14s ease;
      background:#fff;
    }
    textarea:focus{
      border-color: rgba(37,99,235,.55);
      box-shadow: var(--ring);
    }

    .checkrow{
      display:flex;
      align-items:flex-start;
      gap:10px;
      margin-top: 12px;
      padding: 10px 12px;
      border: 1px solid rgba(226,232,240,.95);
      border-radius: 14px;
      background: #fff;
    }
    .checkrow input{ margin-top: 2px; }
    .checkrow .ctext{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }
    .tooltip{
      position:relative;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,.45);
      background:#f8fafc;
      color: var(--muted2);
      font-size: 12px;
      line-height: 1;
      cursor: help;
      user-select:none;
    }
    .tooltip::after{
      content: attr(data-tip);
      position:absolute;
      left: 50%;
      bottom: calc(100% + 10px);
      transform: translateX(-50%);
      width: min(260px, 70vw);
      background: #0b1220;
      color: rgba(255,255,255,.92);
      padding: 8px 10px;
      border-radius: 12px;
      font-size: 12px;
      line-height:1.35;
      opacity:0;
      pointer-events:none;
      transition: opacity .14s ease, transform .14s ease;
      box-shadow: 0 16px 40px rgba(0,0,0,.25);
    }
    .tooltip::before{
      content:"";
      position:absolute;
      left:50%;
      bottom: calc(100% + 4px);
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: #0b1220;
      opacity:0;
      transition: opacity .14s ease;
    }
    .tooltip:hover::after, .tooltip:focus-visible::after{
      opacity:1;
      transform: translateX(-50%) translateY(-2px);
    }
    .tooltip:hover::before, .tooltip:focus-visible::before{ opacity:1; }

    .statusline{
      margin-top: 10px;
      font-size: 12.5px;
      color: var(--muted);
      display:flex;
      align-items:center;
      gap:10px;
      min-height: 18px;
    }
    .statusline .dot{
      width: 8px; height: 8px; border-radius: 999px; background: rgba(148,163,184,.65);
    }
    .statusline.sending{ color: var(--muted); }
    .statusline.sending .dot{ background: rgba(37,99,235,.75); }
    .statusline.ok{ color: #166534; }
    .statusline.ok .dot{ background: rgba(22,163,74,.85); }
    .statusline.err{ color: #991b1b; }
    .statusline.err .dot{ background: rgba(220,38,38,.85); }

    .ticket{
      display:none;
      margin-top: 14px;
      padding: 14px 14px;
      border: 1px solid rgba(226,232,240,.95);
      border-radius: 18px;
      background: linear-gradient(180deg, #ffffff, #fbfdff);
      box-shadow: var(--shadow2);
    }
    .ticket.show{ display:block; }
    .ticket .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }
    .ticket h4{
      margin:0;
      font-size: 13.5px;
      letter-spacing:.2px;
    }
    .ticket .rows{
      display:grid;
      grid-template-columns: 180px 1fr;
      gap: 8px 14px;
      align-items:center;
    }
    .ticket .rows .k{ font-size: 12.5px; }
    .ticket .rows .v{ font-size: 13.5px; }

    /* Focus styles */
    :focus{ outline: none; }
    :focus-visible{
      box-shadow: var(--ring);
      border-color: rgba(37,99,235,.55) !important;
    }

    /* Modal */
    .modalOverlay{
      position:fixed;
      inset:0;
      background: rgba(15,23,42,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
    }
    .modalOverlay.open{ display:flex; }
    .modal{
      width: min(720px, 92vw);
      background: #fff;
      border-radius: 18px;
      border: 1px solid rgba(226,232,240,.95);
      box-shadow: 0 24px 70px rgba(0,0,0,.25);
      overflow:hidden;
      animation: pop .16s ease-out both;
    }
    @keyframes pop{
      from{ opacity:0; transform: translateY(6px) scale(.99); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }
    .modal .mhd{
      padding: 14px 16px;
      border-bottom: 1px solid rgba(226,232,240,.75);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      background: linear-gradient(180deg, #ffffff, #fbfdff);
    }
    .modal .mhd h3{
      margin:0;
      font-size: 14px;
      letter-spacing:.2px;
    }
    .modal .mhd p{
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 12.5px;
      line-height:1.35;
    }
    .xbtn{
      appearance:none;
      border:1px solid rgba(226,232,240,.95);
      background:#fff;
      width: 34px;
      height: 34px;
      border-radius: 12px;
      cursor:pointer;
      display:grid;
      place-items:center;
      transition: background .14s ease, transform .14s ease;
      flex:0 0 auto;
    }
    .xbtn:hover{ background:#f8fafc; transform: translateY(-1px); }
    .modal .mbd{
      padding: 14px 16px 16px;
      display:grid;
      gap: 12px;
    }

    .jira{
      border: 1px solid rgba(226,232,240,.95);
      border-radius: 16px;
      overflow:hidden;
      background:#fff;
    }
    .jira .row{
      display:grid;
      grid-template-columns: 160px 1fr;
      gap: 12px;
      padding: 10px 12px;
      border-top: 1px solid rgba(226,232,240,.75);
    }
    .jira .row:first-child{ border-top:none; }
    .jira .row .k{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted2);
    }
    .jira .row .v{
      font-size: 13.5px;
      color: var(--text);
      line-height:1.45;
    }
    .jira .row .v code{
      font-family: var(--mono);
      background:#f1f5f9;
      border:1px solid rgba(226,232,240,.9);
      padding: 1px 6px;
      border-radius: 8px;
      font-size: 12px;
    }

    .sysErrorBox{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .gifBox{
      border-radius: 16px;
      border: 1px solid rgba(226,232,240,.95);
      background: #f8fafc;
      overflow:hidden;
      display:grid;
      place-items:center;
      min-height: 220px;
    }
    .gifBox img{
      width:100%;
      height:auto;
      display:block;
      max-height: 340px;
      object-fit: cover;
    }

    .sr-only{
      position:absolute;
      width:1px;
      height:1px;
      padding:0;
      margin:-1px;
      overflow:hidden;
      clip:rect(0,0,0,0);
      white-space:nowrap;
      border:0;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <!-- Minimal QA glyph -->
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M7 12l3 3 7-7" stroke="rgba(37,99,235,.95)" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 12a9 9 0 1 1-6.2-8.6" stroke="rgba(15,23,42,.22)" stroke-width="2.2" stroke-linecap="round"/>
          </svg>
        </div>
        <div>
          <h1>QA тестовый стенд</h1>
          <p>Smoke suite → Release approval. Ничего лишнего. Почти.</p>
        </div>
      </div>

      <div class="meta">
        <div class="pillrow" id="pills">
          <span class="pill"><strong>mode</strong>: test</span>
          <span class="pill"><strong>auth</strong>: off</span>
          <span class="pill"><strong>trace</strong>: minimal</span>
        </div>
        <div class="hint">Навигация: <code>Tab</code> · Закрыть модалки: <code>Esc</code></div>
      </div>
    </header>

    <main>
      <section class="grid">
        <div class="card" id="envCard">
          <div class="hd">
            <div>
              <h2>Test Environment</h2>
              <div class="sub">Сводка стенда и метаданные деплоя.</div>
            </div>
            <span class="badge neutral" id="envStatus">READY</span>
          </div>
          <div class="bd">
            <div class="kv">
              <div class="k">Build version</div>
              <div class="v"><code id="buildVer">v1.0.0-qa</code></div>

              <div class="k">Environment</div>
              <div class="v"><code id="envName">staging</code></div>

              <div class="k">Last deploy time</div>
              <div class="v" id="deployTime">—</div>

              <div class="k">Owner</div>
              <div class="v"><code>QA</code></div>
            </div>
          </div>
        </div>

        <div class="card" id="smokeCard">
          <div class="hd">
            <div>
              <h2>Smoke tests</h2>
              <div class="sub">Быстро проверить базовую жизнеспособность релиза.</div>
            </div>
          </div>
          <div class="bd">
            <div class="actions">
              <button class="btn" id="runBtn" type="button">Run smoke tests</button>
              <button class="btn secondary" id="resetBtn" type="button" disabled>Reset</button>
            </div>

            <div class="progress" id="progress">
              <div class="spinner" aria-hidden="true"></div>
              <div class="bar" aria-hidden="true"><i></i></div>
              <div class="progtext" id="progText">Инициализация…</div>
            </div>

            <div class="tests" id="testsList" aria-live="polite"></div>

            <div class="approveRow">
              <div class="hint">
                Gate: <code>release_approval</code> · Policy: <code>manual</code>
              </div>
              <button class="btn secondary" id="approveBtn" type="button" disabled>Approve release / Merge to production</button>
            </div>
          </div>
        </div>
      </section>

      <section class="card reveal" id="inviteCard">
        <div class="hd">
          <div>
            <h2>Release notes</h2>
            <div class="sub">Изменения в релизе: минимум шума, максимум смысла.</div>
          </div>
          <span class="badge neutral" id="relBadge">DRAFT</span>
        </div>
        <div class="bd">
          <div class="notes">
            <div class="note">
              <h3>Исправление</h3>
              <p>Найден баг: мы давно не виделись. Предлагаю хотфикс — встреча. Выбери слот, пожалуйста.</p>
            </div>

            <div class="note">
              <h3>Параметры релиза</h3>
              <p>Слоты оформлены как стабильные артефакты. Риск учитывается отдельно — для честной оценки стабильности.</p>
            </div>
          </div>

          <div style="margin-top:14px; display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
            <div class="hint">Выбор слота</div>
            <span class="badge neutral" id="slotHint">REQUIRED</span>
          </div>

          <div class="slots" id="slots"></div>

          <div class="checkrow">
            <input type="checkbox" id="riskFlag" />
            <div class="ctext">
              <label for="riskFlag" style="margin:0; color:var(--text); font-size:13.5px;">
                Риск: в этот день меня могут послать (включить оценку риска)
              </label>
              <span class="tooltip" tabindex="0" data-tip="Нужно для оценки стабильности релиза. Чисто инженерная формальность.">i</span>
            </div>
          </div>

          <div class="fieldRow" id="commentWrap" style="display:none;">
            <div class="field">
              <label for="comment">Комментарий / альтернатива (опционально)</label>
              <textarea id="comment" placeholder="Например: «Не могу в эти дни, давай во вторник после 19:00»"></textarea>
            </div>
          </div>

          <div class="actions" style="margin-top:12px;">
            <button class="btn" id="confirmBtn" type="button">Подтвердить слот</button>
            <button class="btn secondary" id="reschedBtn" type="button">Предложить другой слот</button>
            <span style="flex:1 1 auto;"></span>
            <button class="btn danger" id="rejectBtn" type="button">Отказаться от свидания</button>
          </div>

          <div class="statusline" id="sendStatus" aria-live="polite">
            <span class="dot" aria-hidden="true"></span>
            <span id="sendText">Готово к отправке.</span>
          </div>

          <div class="ticket" id="ticket">
            <div class="top">
              <div>
                <h4>Ticket</h4>
                <div class="hint">Запись создана в системе уведомлений.</div>
              </div>
              <button class="btn secondary" id="copyBtn" type="button">Copy details</button>
            </div>
            <div class="rows">
              <div class="k">Status</div>
              <div class="v"><span class="badge pass">SCHEDULED</span></div>

              <div class="k">Slot</div>
              <div class="v" id="tSlot">—</div>

              <div class="k">Risk flag</div>
              <div class="v" id="tRisk">—</div>

              <div class="k">Timestamp</div>
              <div class="v" id="tTime">—</div>

              <div class="k">Action</div>
              <div class="v" id="tAction">—</div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Bug Report Modal -->
  <div class="modalOverlay" id="bugOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Bug report" aria-describedby="bugDesc">
      <div class="mhd">
        <div>
          <h3 id="bugTitle">Bug report</h3>
          <p id="bugDesc">Формат близкий к Jira/YouTrack. Никакой паники, только факты.</p>
        </div>
        <button class="xbtn" type="button" data-close="bugOverlay" aria-label="Закрыть модалку">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M6 6l12 12M18 6L6 18" stroke="rgba(15,23,42,.7)" stroke-width="2.2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      <div class="mbd">
        <div class="jira" id="bugBody"></div>
        <div class="hint">Подсказка: некоторые баги исправляются выбором слота и лёгкой решимостью.</div>
      </div>
    </div>
  </div>

  <!-- System Error Modal -->
  <div class="modalOverlay" id="errOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="System error">
      <div class="mhd">
        <div>
          <h3>System error</h3>
          <p>Сервис временно не поддерживает запрошенную операцию.</p>
        </div>
        <button class="xbtn" type="button" data-close="errOverlay" aria-label="Закрыть модалку">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path d="M6 6l12 12M18 6L6 18" stroke="rgba(15,23,42,.7)" stroke-width="2.2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
      <div class="mbd">
        <div class="sysErrorBox">
          <div class="hint" style="font-size:13.5px; color: var(--text);">
            Системная ошибка: в данный момент отказ невозможен. Попробуйте позже.
          </div>
          <div class="gifBox" id="gifBox" aria-label="GIF placeholder"></div>
          <div class="hint">Инцидент зарегистрирован. SLA: неопределённый, как и причина улыбки.</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // =========================
    // Настройки (меняй тут)
    // =========================
    const WEBHOOK_URL = "https://example.com/telegram-webhook";
    const GIF_URL = ""; // если пусто — будет fallback SVG
    const SLOTS = [
      { id: "SLOT_1", label: "Четверг, 19:30", note: "Тёплый старт. Минимум контекста — максимум вкуса." },
      { id: "SLOT_2", label: "Пятница, 20:00", note: "Удобно для релиза после рабочего дня." },
      { id: "SLOT_3", label: "Суббота, 16:00", note: "Дневной стабильный билд, без спешки." },
      { id: "SLOT_4", label: "Воскресенье, 18:00", note: "Мягкий финал недели. Спокойный деплой." }
    ];

    // Инвайти (нужно для payload)
    const INVITEE_NAME = "Самира";

    // =========================
    // Helpers
    // =========================
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

    const fmtTime = (d = new Date()) => {
      try {
        return new Intl.DateTimeFormat("ru-RU", {
          timeZone: "Europe/Amsterdam",
          year: "numeric", month: "2-digit", day: "2-digit",
          hour: "2-digit", minute: "2-digit", second: "2-digit"
        }).format(d).replace(",", "");
      } catch {
        return d.toLocaleString("ru-RU");
      }
    };

    const sleep = (ms) => new Promise(r => setTimeout(r, ms));

    function safeText(s) {
      return (s ?? "").toString();
    }

    // =========================
    // State
    // =========================
    let smokeDone = false;
    let lastTicket = null;

    // =========================
    // Modal (basic focus trap)
    // =========================
    let activeOverlay = null;
    let lastFocus = null;

    function getFocusable(container) {
      const sel = [
        "a[href]", "button:not([disabled])", "textarea:not([disabled])",
        "input:not([disabled])", "select:not([disabled])", "[tabindex]:not([tabindex='-1'])"
      ].join(",");
      return $$(sel, container).filter(el => el.offsetParent !== null);
    }

    function openOverlay(id) {
      const overlay = document.getElementById(id);
      if (!overlay) return;

      lastFocus = document.activeElement;
      activeOverlay = overlay;

      overlay.classList.add("open");
      overlay.setAttribute("aria-hidden", "false");

      const focusables = getFocusable(overlay);
      (focusables[0] || overlay).focus();

      document.body.style.overflow = "hidden";
    }

    function closeOverlay(id) {
      const overlay = document.getElementById(id);
      if (!overlay) return;

      overlay.classList.remove("open");
      overlay.setAttribute("aria-hidden", "true");

      document.body.style.overflow = "";
      activeOverlay = null;

      if (lastFocus && typeof lastFocus.focus === "function") {
        lastFocus.focus();
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && activeOverlay) {
        e.preventDefault();
        closeOverlay(activeOverlay.id);
        return;
      }
      if (e.key === "Tab" && activeOverlay) {
        const focusables = getFocusable(activeOverlay);
        if (!focusables.length) return;

        const first = focusables[0];
        const last = focusables[focusables.length - 1];

        if (e.shiftKey && document.activeElement === first) {
          e.preventDefault();
          last.focus();
        } else if (!e.shiftKey && document.activeElement === last) {
          e.preventDefault();
          first.focus();
        }
      }
    });

    document.addEventListener("click", (e) => {
      const closeBtn = e.target.closest("[data-close]");
      if (closeBtn) closeOverlay(closeBtn.getAttribute("data-close"));

      // Prevent overlay click to close (по требованиям — только крестик и Esc)
    });

    // =========================
    // Bug data
    // =========================
    const BUGS = {
      scheduleAmbiguity: {
        key: "INV-17",
        summary: "Schedule a date without ambiguity",
        steps: [
          "Открыть стенд",
          "Запустить smoke suite",
          "Перейти к Release approval",
          "Не выбрать слот и попытаться продолжить"
        ],
        expected:
          "Система предлагает чёткие варианты времени и даёт возможность выбрать один без лишних переговоров.",
        actual:
          "Система не может угадать подходящий слот. Нужен ручной ввод: выбор карточки слота (и, если надо, комментарий).",
        priority: "High"
      },
      rejectIsBroken: {
        key: "INV-21",
        summary: "Reject button behaves as expected",
        steps: [
          "Перейти к блоку приглашения",
          "Нажать «Отказаться от свидания»"
        ],
        expected:
          "Отказ обрабатывается аккуратно и предлагает безопасный путь: «не сейчас» → «предложить альтернативу».",
        actual:
          "Показывается System error. Это известное ограничение текущей версии: вместо отказа предусмотрен сценарий «предложить другой слот».",
        priority: "Medium (intentional)"
      }
    };

    function renderBug(bug) {
      const body = document.getElementById("bugBody");
      const title = document.getElementById("bugTitle");

      title.textContent = `${bug.key} · ${bug.summary}`;

      body.innerHTML = `
        <div class="row">
          <div class="k">Summary</div>
          <div class="v">${safeText(bug.summary)}</div>
        </div>
        <div class="row">
          <div class="k">Steps</div>
          <div class="v">${bug.steps.map(s => `• ${safeText(s)}`).join("<br>")}</div>
        </div>
        <div class="row">
          <div class="k">Expected</div>
          <div class="v">${safeText(bug.expected)}</div>
        </div>
        <div class="row">
          <div class="k">Actual</div>
          <div class="v">${safeText(bug.actual)}</div>
        </div>
        <div class="row">
          <div class="k">Priority</div>
          <div class="v"><code>${safeText(bug.priority)}</code></div>
        </div>
      `;
    }

    // =========================
    // UI init
    // =========================
    function initEnv() {
      $("#deployTime").textContent = fmtTime(new Date());
      $("#buildVer").textContent = "v1.0.7-qa";
      $("#envName").textContent = "staging";
    }

    function initSlots() {
      const wrap = $("#slots");
      wrap.innerHTML = "";

      SLOTS.forEach((s, idx) => {
        const id = `slot_${idx}`;
        const el = document.createElement("label");
        el.className = "slotCard";
        el.innerHTML = `
          <input type="radio" name="slot" value="${s.label}" aria-label="Слот: ${s.label}">
          <div class="inner">
            <div>
              <div class="title">${safeText(s.label)}</div>
              <p class="desc">${safeText(s.note || "")}</p>
            </div>
            <span class="badge slot">SLOT</span>
          </div>
        `;
        wrap.appendChild(el);
      });

      wrap.addEventListener("change", () => {
        $$(".slotCard", wrap).forEach(card => card.classList.remove("selected"));
        const checked = $("input[name='slot']:checked", wrap);
        if (checked) checked.closest(".slotCard").classList.add("selected");
        $("#slotHint").textContent = "SELECTED";
        $("#slotHint").className = "badge pass";
      });
    }

    function setStatus(state, text) {
      const line = $("#sendStatus");
      const t = $("#sendText");
      line.classList.remove("sending", "ok", "err");
      if (state) line.classList.add(state);
      t.textContent = text;
    }

    // =========================
    // Smoke tests
    // =========================
    const TEST_CASES = [
      { name: "Open invite page", status: "PASS", tag: "INV-BOOT" },
      { name: "Render test environment cards", status: "PASS", tag: "UI-ENV" },
      { name: "User mood improves after coffee", status: "PASS", tag: "UX-SANITY" },
      { name: "Schedule a date without ambiguity", status: "FAIL", tag: "INV-17", bug: "scheduleAmbiguity" },
      { name: "Timezone mismatch does not break flow", status: "PASS", tag: "TZ-OK" },
      { name: "Reject button behaves as expected", status: "FAIL", tag: "INV-21", bug: "rejectIsBroken" },
      { name: "Notification pipeline is reachable", status: "PASS", tag: "HOOK-PING" },
      { name: "Typography remains calm under load", status: "PASS", tag: "UI-TYPE" }
    ];

    function renderTests() {
      const list = $("#testsList");
      list.innerHTML = "";

      TEST_CASES.forEach(tc => {
        const row = document.createElement("div");
        row.className = "trow";

        const badgeClass = tc.status === "PASS" ? "pass" : "fail";
        const bugLink = tc.status === "FAIL"
          ? `<button type="button" class="linkbtn" data-bug="${tc.bug}">View bug report</button>`
          : `<span class="sr-only">No bug report</span>`;

        row.innerHTML = `
          <div class="tname">${safeText(tc.name)}</div>
          <div class="tmeta">${safeText(tc.tag)}</div>
          <div style="display:flex; align-items:center; gap:10px; justify-content:flex-end;">
            <span class="badge ${badgeClass}">${tc.status}</span>
            ${bugLink}
          </div>
        `;
        list.appendChild(row);
      });

      list.addEventListener("click", (e) => {
        const btn = e.target.closest("[data-bug]");
        if (!btn) return;
        const key = btn.getAttribute("data-bug");
        const bug = BUGS[key];
        if (!bug) return;
        renderBug(bug);
        openOverlay("bugOverlay");
      }, { once: true });
    }

    async function runSmoke() {
      if (smokeDone) return;

      $("#runBtn").disabled = true;
      $("#resetBtn").disabled = true;
      $("#envStatus").textContent = "RUNNING";
      $("#envStatus").className = "badge neutral";

      $("#progress").classList.add("show");
      $("#testsList").classList.remove("show");
      $("#approveBtn").disabled = true;

      const steps = [
        "Инициализация окружения…",
        "Прогрев кэшей и холодных взглядов…",
        "Выполнение smoke suite…",
        "Сбор результатов…"
      ];
      const total = 2000 + Math.floor(Math.random() * 2000); // 2–4 sec
      const tick = 280;
      let elapsed = 0;

      while (elapsed < total) {
        const i = Math.min(steps.length - 1, Math.floor((elapsed / total) * steps.length));
        $("#progText").textContent = steps[i];
        await sleep(tick);
        elapsed += tick;
      }

      $("#progText").textContent = "Готово. Есть нюансы.";
      renderTests();
      $("#testsList").classList.add("show");
      $("#progress").classList.remove("show");

      smokeDone = true;
      $("#envStatus").textContent = "READY";
      $("#envStatus").className = "badge neutral";
      $("#approveBtn").disabled = false;
      $("#resetBtn").disabled = false;
    }

    function resetAll() {
      smokeDone = false;
      lastTicket = null;

      $("#runBtn").disabled = false;
      $("#approveBtn").disabled = true;
      $("#testsList").classList.remove("show");
      $("#testsList").innerHTML = "";
      $("#inviteCard").classList.remove("show");
      $("#inviteCard").classList.remove("fadeIn");
      $("#relBadge").textContent = "DRAFT";
      $("#relBadge").className = "badge neutral";

      // form reset
      $$("input[name='slot']").forEach(i => i.checked = false);
      $$(".slotCard").forEach(c => c.classList.remove("selected"));
      $("#riskFlag").checked = false;
      $("#comment").value = "";
      $("#commentWrap").style.display = "none";

      $("#ticket").classList.remove("show");
      $("#tSlot").textContent = "—";
      $("#tRisk").textContent = "—";
      $("#tTime").textContent = "—";
      $("#tAction").textContent = "—";

      $("#slotHint").textContent = "REQUIRED";
      $("#slotHint").className = "badge neutral";

      setStatus(null, "Готово к отправке.");
    }

    // =========================
    // Release approval -> Invite
    // =========================
    function showInvite() {
      const card = $("#inviteCard");
      card.classList.add("show", "fadeIn");
      $("#relBadge").textContent = "READY FOR INPUT";
      $("#relBadge").className = "badge neutral";
      // мягко прокрутить
      card.scrollIntoView({ behavior: "smooth", block: "start" });
    }

    // =========================
    // System error GIF
    // =========================
    function initGifBox() {
      const box = $("#gifBox");
      if (GIF_URL && GIF_URL.trim().length > 0) {
        const img = document.createElement("img");
        img.alt = "System error gif";
        img.src = GIF_URL.trim();
        img.loading = "lazy";
        img.referrerPolicy = "no-referrer";
        box.innerHTML = "";
        box.appendChild(img);
      } else {
        // fallback SVG
        box.innerHTML = `
          <svg width="220" height="140" viewBox="0 0 220 140" fill="none" aria-hidden="true">
            <rect x="12" y="12" width="196" height="116" rx="18" fill="#ffffff" stroke="rgba(226,232,240,.95)" />
            <path d="M58 96c9 0 14-6 22-6s13 6 22 6 14-6 22-6 13 6 22 6" stroke="rgba(148,163,184,.65)" stroke-width="2.2" stroke-linecap="round"/>
            <path d="M74 52h72" stroke="rgba(15,23,42,.25)" stroke-width="2.2" stroke-linecap="round"/>
            <path d="M74 64h52" stroke="rgba(15,23,42,.18)" stroke-width="2.2" stroke-linecap="round"/>
            <circle cx="110" cy="84" r="18" fill="rgba(220,38,38,.08)" stroke="rgba(220,38,38,.35)" />
            <path d="M110 76v12" stroke="rgba(220,38,38,.8)" stroke-width="2.6" stroke-linecap="round"/>
            <path d="M110 94h.01" stroke="rgba(220,38,38,.8)" stroke-width="4.2" stroke-linecap="round"/>
          </svg>
          <div class="hint" style="padding: 0 12px 12px; text-align:center;">GIF_URL не задан. Fallback активирован.</div>
        `;
      }
    }

    // =========================
    // Submit to webhook
    // =========================
    function getSelectedSlot() {
      const checked = $("input[name='slot']:checked");
      return checked ? checked.value : "";
    }

    function payload(action) {
      return {
        name: INVITEE_NAME,
        selected_slot: getSelectedSlot(),
        risk_flag: !!$("#riskFlag").checked,
        comment: safeText($("#comment").value).trim(),
        action
      };
    }

    async function send(action) {
      const slot = getSelectedSlot();

      if (!slot) {
        setStatus("err", "Ошибка: выбери слот (это тот самый ручной ввод).");
        $("#slots").scrollIntoView({ behavior: "smooth", block: "center" });
        return;
      }

      const p = payload(action);

      setStatus("sending", "Отправляю…");

      try {
        const res = await fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(p)
        });

        const ct = (res.headers.get("content-type") || "").toLowerCase();
        const bodyText = ct.includes("application/json") ? JSON.stringify(await res.json()) : await res.text();

        if (!res.ok) {
          throw new Error(`HTTP ${res.status}: ${bodyText || "Unknown error"}`);
        }

        setStatus("ok", "Отправлено");

        const ts = fmtTime(new Date());
        lastTicket = {
          status: "SCHEDULED",
          slot: p.selected_slot,
          risk: p.risk_flag,
          timestamp: ts,
          action: p.action
        };

        $("#ticket").classList.add("show");
        $("#tSlot").textContent = lastTicket.slot;
        $("#tRisk").textContent = lastTicket.risk ? "true" : "false";
        $("#tTime").textContent = lastTicket.timestamp;
        $("#tAction").textContent = lastTicket.action;

        // слегка “запечатываем” сценарий после успеха
        $("#confirmBtn").disabled = true;
        $("#reschedBtn").disabled = true;
        $("#rejectBtn").disabled = true;
        $("#relBadge").textContent = "MERGED";
        $("#relBadge").className = "badge pass";
      } catch (err) {
        setStatus("err", `Ошибка отправки: ${err && err.message ? err.message : "unknown"}`);
      }
    }

    async function sendAccept() {
      $("#commentWrap").style.display = "none";
      await send("accept");
    }

    async function sendReschedule() {
      // раскрываем поле, но не заставляем заполнять — просто делаем путь очевидным
      $("#commentWrap").style.display = "block";
      $("#comment").focus({ preventScroll: true });
      await send("reschedule");
    }

    function copyTicket() {
      if (!lastTicket) return;

      const text =
        `Status: ${lastTicket.status}\n` +
        `Slot: ${lastTicket.slot}\n` +
        `Risk flag: ${lastTicket.risk}\n` +
        `Timestamp: ${lastTicket.timestamp}\n` +
        `Action: ${lastTicket.action}`;

      const ok = () => setStatus("ok", "Скопировано в буфер обмена");

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(ok).catch(() => fallbackCopy(text));
      } else {
        fallbackCopy(text);
      }

      function fallbackCopy(t) {
        const ta = document.createElement("textarea");
        ta.value = t;
        ta.style.position = "fixed";
        ta.style.left = "-9999px";
        ta.style.top = "0";
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        try {
          document.execCommand("copy");
          ok();
        } catch {
          setStatus("err", "Не удалось скопировать. Можно выделить вручную.");
        } finally {
          document.body.removeChild(ta);
        }
      }
    }

    // =========================
    // Wire up
    // =========================
    initEnv();
    initSlots();
    initGifBox();
    setStatus(null, "Готово к отправке.");

    $("#runBtn").addEventListener("click", runSmoke);
    $("#resetBtn").addEventListener("click", resetAll);

    $("#approveBtn").addEventListener("click", () => {
      if (!smokeDone) return;
      showInvite();
    });

    $("#confirmBtn").addEventListener("click", sendAccept);
    $("#reschedBtn").addEventListener("click", sendReschedule);

    $("#rejectBtn").addEventListener("click", () => {
      openOverlay("errOverlay");
    });

    $("#copyBtn").addEventListener("click", copyTicket);

    // Обновляем last deploy “как будто”
    setInterval(() => {
      // не дергаем постоянно, просто поддерживаем ощущение живости стенда
      // (каждые 30 секунд обновим, без агрессии)
    }, 30000);

    // стартовый reset на случай перезагрузки
    resetAll();
    initEnv(); // вернём время деплоя после reset
  </script>
</body>
</html>
